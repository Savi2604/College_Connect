<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Post Announcement - Admin</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="../css/modern-ui.css">
    <style>
        body {
            font-family: 'Segoe UI', sans-serif;
            padding: 20px;
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
            background: var(--card-bg-light);
            backdrop-filter: blur(16px);
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            border: 1px solid var(--border-light);
        }

        h2 {
            color: var(--text-light);
            text-align: center;
            margin-bottom: 25px;
        }

        .form-group {
            margin-bottom: 20px;
            position: relative;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--text-light);
        }

        input,
        textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid var(--border-light);
            border-radius: 8px;
            font-size: 14px;
            outline: none;
            box-sizing: border-box;
            background: rgba(255, 255, 255, 0.05);
            /* Subtle input bg */
            color: var(--text-light);
        }

        input:focus,
        textarea:focus {
            border-color: var(--primary);
            background: var(--card-bg-light);
        }

        /* Dropdown Style */
        .multiselect-box {
            border: 1px solid var(--border-light);
            border-radius: 8px;
            padding: 12px;
            background: rgba(255, 255, 255, 0.05);
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 14px;
            color: var(--text-light);
        }

        .options-container {
            display: none;
            position: absolute;
            width: 100%;
            background: var(--card-bg-light);
            backdrop-filter: blur(20px);
            border: 1px solid var(--border-light);
            border-radius: 8px;
            margin-top: 5px;
            z-index: 10;
            max-height: 200px;
            overflow-y: auto;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }

        .options-container.active {
            display: block;
        }

        .option-item {
            padding: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
            border-bottom: 1px solid var(--border-light);
            cursor: pointer;
            color: var(--text-light);
        }

        .option-item:hover {
            background: var(--primary);
            color: white;
        }

        .option-item input[type="checkbox"] {
            width: auto;
            margin-right: 5px;
        }

        .btn-send {
            width: 100%;
            background: var(--primary);
            color: white;
            padding: 15px;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: 0.3s;
            margin-top: 20px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        .btn-send:hover {
            background: var(--primary-hover);
            transform: translateY(-2px);
        }

        /* Float "Back to Dashboard" similar to other pages */
    </style>
</head>

<body>
    <div class="dynamic-bg"></div>

    <div class="container">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px;">
            <h2 style="margin: 0;"><i class="fas fa-bullhorn" style="color: #008080;"></i> Post New Announcement</h2>
        </div>

        <div class="form-group">
            <label>Title</label>
            <input type="text" id="title" placeholder="Enter title...">
        </div>

        <div class="form-group">
            <label>Message</label>
            <textarea id="message" placeholder="Type message..."></textarea>
        </div>

        <div class="form-group">
            <label>Target Departments</label>
            <div class="multiselect-box" onclick="toggleDropdown('deptOptions')">
                <span id="deptLabel">Select Departments</span>
                <i class="fas fa-chevron-down"></i>
            </div>
            <div class="options-container" id="deptOptions">
                <label class="option-item"><input type="checkbox" class="dept-cb" value="IT" onchange="updateLabels()">
                    IT</label>
                <label class="option-item"><input type="checkbox" class="dept-cb" value="CSE" onchange="updateLabels()">
                    CSE</label>
                <label class="option-item"><input type="checkbox" class="dept-cb" value="ECE" onchange="updateLabels()">
                    ECE</label>
                <label class="option-item"><input type="checkbox" class="dept-cb" value="EEE" onchange="updateLabels()">
                    EEE</label>
                <label class="option-item"><input type="checkbox" class="dept-cb" value="MECH"
                        onchange="updateLabels()"> MECH</label>
                <label class="option-item"><input type="checkbox" class="dept-cb" value="AUTO"
                        onchange="updateLabels()"> AUTO</label>
                <label class="option-item"><input type="checkbox" class="dept-cb" value="CIVIL"
                        onchange="updateLabels()"> CIVIL</label>
            </div>
        </div>

        <div class="form-group">
            <label>Target Year(s)</label>
            <div class="multiselect-box" onclick="toggleDropdown('yearOptions')">
                <span id="yearLabel">Select Year(s)</span>
                <i class="fas fa-chevron-down"></i>
            </div>
            <div class="options-container" id="yearOptions">
                <label class="option-item"><input type="checkbox" id="allYears" onclick="selectAllYears(this)">
                    <b>ALL YEARS</b></label>
                <label class="option-item"><input type="checkbox" class="year-cb" value="1" onchange="updateLabels()">
                    1st Year</label>
                <label class="option-item"><input type="checkbox" class="year-cb" value="2" onchange="updateLabels()">
                    2nd Year</label>
                <label class="option-item"><input type="checkbox" class="year-cb" value="3" onchange="updateLabels()">
                    3rd Year</label>
                <label class="option-item"><input type="checkbox" class="year-cb" value="4" onchange="updateLabels()">
                    4th Year</label>
            </div>
        </div>

        <button class="btn-send" onclick="sendNotice()">Send Announcement</button>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, push, set } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyAZOJh_a5oDaKluV3IU6Ly2o7PlTlSEbhQ",
            authDomain: "college-connect-2cd42.firebaseapp.com",
            databaseURL: "https://college-connect-2cd42-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "college-connect-2cd42",
            storageBucket: "college-connect-2cd42.firebasestorage.app",
            messagingSenderId: "16394931571",
            appId: "1:16394931571:web:38b8abc12ec26d7dc50906"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        window.toggleDropdown = (id) => {
            const el = document.getElementById(id);
            const isActive = el.classList.contains('active');
            document.querySelectorAll('.options-container').forEach(c => c.classList.remove('active'));
            if (!isActive) el.classList.add('active');
        }

        window.selectAllYears = (source) => {
            document.querySelectorAll('.year-cb').forEach(cb => cb.checked = source.checked);
            updateLabels();
        }

        window.updateLabels = () => {
            const depts = document.querySelectorAll('.dept-cb:checked').length;
            const years = document.querySelectorAll('.year-cb:checked').length;
            document.getElementById('deptLabel').innerText = depts > 0 ? `${depts} Selected` : "Select Departments";
            document.getElementById('yearLabel').innerText = years > 0 ? `${years} Selected` : "Select Year(s)";
        }

        window.sendNotice = async function () {
            const title = document.getElementById('title').value;
            const msg = document.getElementById('message').value;
            const selectedDepts = Array.from(document.querySelectorAll('.dept-cb:checked')).map(cb => cb.value);
            const selectedYears = Array.from(document.querySelectorAll('.year-cb:checked')).map(cb => cb.value);

            if (!title || !msg || selectedDepts.length === 0 || selectedYears.length === 0) {
                alert("Fill all the fields!");
                return;
            }

            const data = {
                title, message: msg,
                targetDepts: selectedDepts,
                targetYears: selectedYears,
                timestamp: Date.now(),
                date: new Date().toLocaleDateString()
            };

            try {
                await push(ref(db, 'announcements/'), data);
                alert("Successfully sent!");
                location.reload();
            } catch (e) { alert("Error!"); }
        }

        window.onclick = (e) => {
            if (!e.target.closest('.form-group')) {
                document.querySelectorAll('.options-container').forEach(el => el.classList.remove('active'));
            }
        }
    </script>

    <script src="../js/ui.js"></script>
</body>

</html>